########################################################################################################
# Gabor.R
#
# Analysis of malware textures using Gabor filters
#
# Author: Eduarda Chagas
# Date : Set 2020
# Contact: eduarda.chagas@dcc.ufmg.br
########################################################################################################

############################################# Packages #################################################
if(!require(gtools)){
  install.packages("gtools")
  require(gtools)
}
if(!require(OpenImageR)){
  install.packages("OpenImageR")
  require(OpenImageR)
}
if(!require(png)){
  install.packages("png")
  require(png)
}

###################################### Function of Analysis ##########################################

gabor.analysis <- function(){
  n.images = 9339
  #n.images = 10
  gabor.data = matrix(nrow = n.images, ncol = 80)
  init_gb = GaborFeatureExtract$new()
  
  for(j in 1:n.images){
    
    img = readImage(paste0("../IMG/X[", j-1,  "].png"))
    img = img[,,1]
    img = t(apply(img, 2, rev)) 
    #image(img, col  = gray((0:255)/255))
    
    gb_f = init_gb$gabor_feature_extraction(image = img, scales = 5, orientations = 8, 
                                            gabor_rows = 40, gabor_columns = 40)
    #gb_f$gaborFeatures$energy_aptitude
    gabor.data[j,] = gb_f$gaborFeatures$energy_aptitude
    cat("Malware ", j, " of ", n.images, "\n")
  }
  write.csv(gabor.data,'../Data/gabor.csv', row.names = FALSE)
}

gabor.analysis()
